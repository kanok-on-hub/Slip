<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏Ñ‡∏•‡∏°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <style>
    :root{
      --primary:#111827;--bg:#F3F4F6;--card:#fff;--text:#1F2937;--muted:#6B7280;
      --border:#E5E7EB;--danger:#EF4444;--success:#10B981;--accent:#F9FAFB;
    }
    body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;margin:0;padding:20px 16px;background:var(--bg);color:var(--text);}
    .container{max-width:480px;margin:0 auto;background:var(--card);border-radius:20px;box-shadow:0 10px 25px -5px rgba(0,0,0,.05),0 8px 10px -6px rgba(0,0,0,.01);padding:24px;box-sizing:border-box;}
    .header{text-align:center;margin-bottom:24px;}
    .icon{font-size:40px;margin-bottom:12px;}
    h1{font-size:20px;font-weight:800;margin:0 0 8px;}
    .subtitle{font-size:13px;color:var(--muted);line-height:1.5}
    .info{background:var(--accent);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:24px;}
    .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:13px;}
    .row:last-child{margin-bottom:0}
    .label{color:var(--muted);font-weight:700}
    .value{font-weight:800;text-align:right}
    .field{margin-bottom:16px;}
    .field label{display:block;font-size:13px;font-weight:700;margin-bottom:6px;}
    input{
      width:100%;box-sizing:border-box;padding:12px 14px;border-radius:12px;border:1.5px solid var(--border);
      font-size:15px;color:var(--text);background:#FAFAFA;transition:.2s;
    }
    input:focus{outline:none;border-color:var(--primary);background:#fff;box-shadow:0 0 0 4px rgba(17,24,39,.1)}
    .hint{font-size:12px;color:var(--muted);margin-top:6px;display:flex;gap:6px;align-items:center}
    .buttons{margin-top:26px;display:flex;gap:12px}
    .btn{flex:1;padding:14px 16px;border-radius:14px;border:none;font-size:15px;font-weight:800;cursor:pointer;transition:transform .1s,opacity .2s}
    .btn:active{transform:scale(.98)}
    .btn-primary{background:var(--primary);color:#fff;box-shadow:0 4px 6px -1px rgba(17,24,39,.2)}
    .btn-secondary{background:#E5E7EB;color:#4B5563}
    .msg{margin-top:14px;font-size:13px;font-weight:700;text-align:center;padding:10px;border-radius:10px;display:none}
    .msg.show{display:block}
    .msg.success{background:#D1FAE5;color:#065F46}
    .msg.error{background:#FEE2E2;color:#991B1B}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon">‚úèÔ∏è</div>
      <h1>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏Ñ‡∏•‡∏°</h1>
      <div class="subtitle" id="subtitle">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...</div>
    </div>

    <div id="form" style="display:none;">
      <div class="info">
        <div class="row">
          <span class="label">Run No.</span>
          <span class="value" id="runNoText">-</span>
        </div>
      </div>

      <div class="field">
        <label>üè¢ ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (Company)</label>
        <input id="company" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô AVT, ACC, BDI" />
      </div>

      <div class="field">
        <label>üóìÔ∏è ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å (Period)</label>
        <input id="period" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô 02/2026" />
        <div class="hint">üí° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ ‡πÄ‡∏ä‡πà‡∏ô 02/2026</div>
      </div>

      <div class="field">
        <label>üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Amount)</label>
        <input id="amount" type="number" placeholder="ex. 1200" step="any" />
        <div class="hint">üí° ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥ ( , )</div>
      </div>

      <div class="buttons">
        <button class="btn btn-secondary" type="button" id="btnCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-primary" type="button" id="btnSave">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </div>

      <div id="msg" class="msg"></div>
    </div>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const LIFF_ID = '2009213238-3uwVnWSp';

    function qp() {
      const out = {};
      const s = window.location.search.substring(1);
      if (!s) return out;
      s.split("&").forEach(p => {
        if (!p) return;
        const i = p.indexOf("=");
        const k = decodeURIComponent(i >= 0 ? p.slice(0, i) : p);
        const v = decodeURIComponent(i >= 0 ? p.slice(i+1) : "");
        out[k] = v;
      });
      return out;
    }

    function show(text, type) {
      const el = document.getElementById('msg');
      if (!text) { el.className = 'msg'; el.textContent = ''; return; }
      el.textContent = text;
      el.className = 'msg show ' + (type || '');
    }

    function buildPairs(pairs) {
      return pairs.map(([k, v]) => k + '=' + encodeURIComponent(v ?? '')).join('|');
    }

    async function main() {
      const subtitle = document.getElementById('subtitle');

      try {
        await liff.init({ liffId: LIFF_ID });
      } catch (err) {
        console.error(err);
        subtitle.textContent = '‡πÇ‡∏´‡∏•‡∏î LIFF ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (err.message || err);
        return;
      }

      const p = qp();
      const runNo = (p.runNo || '').trim();
      if (!runNo) {
        subtitle.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Run No ‡πÉ‡∏ô URL';
        return;
      }

      subtitle.textContent = '‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
      document.getElementById('runNoText').textContent = runNo;

      // prefill optional
      if (p.company) document.getElementById('company').value = p.company;
      if (p.period) document.getElementById('period').value = p.period;
      if (p.amount) document.getElementById('amount').value = p.amount;

      document.getElementById('form').style.display = 'block';

      document.getElementById('btnCancel').addEventListener('click', () => {
        try {
          if (liff.isInClient()) liff.closeWindow();
          else show('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß', 'error');
        } catch (e) {}
      });

      document.getElementById('btnSave').addEventListener('click', async () => {
        show('', '');

        if (!liff.isInClient()) {
          show('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô LINE app ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
          return;
        }

        const company = document.getElementById('company').value.trim();
        const period = document.getElementById('period').value.trim();
        const amount = document.getElementById('amount').value.trim();

        if (!company) { show('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó', 'error'); return; }
        if (!period) { show('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å', 'error'); return; }
        if (!amount) { show('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'error'); return; }

        const btn = document.getElementById('btnSave');
        btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á...';
        btn.disabled = true;

        try {
          const cmd = 'CLAIM_EDIT|' + buildPairs([
            ['runNo', runNo],
            ['company', company],
            ['period', period],
            ['amount', amount]
          ]);

          await liff.sendMessages([{ type: 'text', text: cmd }]);
          show('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ', 'success');
          setTimeout(() => { try { liff.closeWindow(); } catch (e) {} }, 800);

        } catch (e) {
          console.error(e);
          show('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
        } finally {
          btn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
          btn.disabled = false;
        }
      });
    }

    window.addEventListener('load', main);
  </script>
</body>
</html>
